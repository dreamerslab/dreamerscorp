$.preload("/img/loading.gif");(function($){$(function(){var current_lang;var lang={en:{sent:"Your message have been sent, thank you!",error:"We are having problems sending your message, please try again later :3"},tw:{sent:"您的意見已經送出，謝謝!",error:"寄送郵件發生錯誤，請稍後再試 :3"}};var validate_rules={name:{required:true},email:{required:true,email:true},message:{required:true}};var validate_msg={name:{required:"en{We need to know who you are.}tw{請填寫您的名字.}"},email:{required:"en{We need to know how to reply you.}tw{請填寫您的電子郵件.}",email:"en{The email format is incorrect.}tw{您輸入的電子郵件格式錯誤.}"},message:{required:"en{Are you sure you want to leave your message empty?}tw{請填寫您的意見.}"}};var $lang={en:$(".en"),tw:$(".tw")};var switch_lang=function($lang,lang){var another=lang==="tw"?"en":"tw";$lang[another].hide();$lang[lang].fadeIn(1000);current_lang=lang;};var browser_lang=function(){if(navigator.language){return navigator.language;}if(navigator.browserLanguage){return navigator.browserLanguage;}return"en-EN";};var send=function(){$form.ajaxSubmit({target:"#jquery-msg-content",url:"/msg.php",dataType:"json",success:function(rsp){var msg=rsp=="success"?lang[current_lang].sent:lang[current_lang].error;$.msg("replace",msg).msg("unblock",3000,1);}});};var $form=$("#contact-form");current_lang=function(){return browser_lang().toLowerCase().split("-")[1]==="tw"?"tw":"en";}();switch_lang($lang,current_lang);$(".switch-lang").click(function(){var lang=$(this).attr("lang");switch_lang($lang,lang);});$form.validate({rules:validate_rules,messages:validate_msg,errorPlacement:function(err,el){return false;},invalidHandler:function(form,validator){var regex=current_lang==="en"?/en\{(.+?)\}/:/tw\{(.+?)\}/;var content=[];$.each(validator.errorList,function(i,err){var match=regex.exec(err.message);if(match.length>1){content.push(match[1]);}});content=content.join("<br />");$.msg({bgPath:"/img/",content:content});},submitHandler:function(){$.msg({autoUnblock:false,afterBlock:send,beforeUnblock:function(){$form.clearForm();},bgPath:"/img/",content:'<img src="/img/loading.gif"/>',msgID:1});}});});})(jQuery);